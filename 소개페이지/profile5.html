<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>나의 자기소개 페이지</title>
<style>
  :root { font-family: "Noto Sans KR", sans-serif; }
  body { max-width: 960px; margin: 30px auto; padding: 20px; background: #f9fafb; line-height: 1.6; }
  header { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
  #profile-img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; cursor: pointer; transition: transform 0.3s; }
  #profile-img:hover { transform: scale(1.05); }
  #status { font-size: 1.1rem; color: #2563eb; font-weight: bold; margin-top: 8px; }
  .card { background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #d1d5db; padding: 8px; text-align: center; }
  th { background: #f3f4f6; }
  button { margin: 5px; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; background: #3b82f6; color: white; }
  button:hover { background: #2563eb; }
  video { border-radius: 12px; margin-top: 10px; width: 100%; max-width: 600px; }

  #editModal, #imageModal {
    display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 10;
  }
  .modal-content {
    background: white; border-radius: 16px; padding: 20px; width: 90%; max-width: 500px;
  }
  .modal-content input, .modal-content textarea { width: 100%; margin: 8px 0; padding: 8px; }

  .gallery-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
  .thumbnail { width: 120px; height: 90px; object-fit: cover; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
  .thumbnail:hover { transform: scale(1.05); }

  #imageModal img { max-width: 90%; max-height: 80vh; border-radius: 10px; }
  .arrow { position: absolute; top: 50%; font-size: 2rem; color: white; background: rgba(0,0,0,0.3);
    padding: 8px 12px; border-radius: 50%; cursor: pointer; user-select: none; }
  .arrow:hover { background: rgba(0,0,0,0.5); }
  .left { left: 20px; } .right { right: 20px; }
</style>
</head>
<body>

<header>
  <div>
    <img id="profile-img" src="me.jpg" alt="내 사진" />
    <div id="status">상태: 😊 준비완료!</div>
  </div>
  <div>
    <h1 id="intro-text">안녕하세요! 저는 <span style="color:#2563eb;">○○초등학교 5학년 ○○○</span>입니다.</h1>
    <p>호기심 많고 새로운 것을 배우는 걸 좋아하는 영재입니다!</p>
  </div>
  <div>
    <button onclick="openEditModal()">자기소개 수정 ✏️</button>
    <button onclick="saveToLocal()">저장하기 💾</button>
    <button onclick="downloadData()">파일로 내보내기 📂</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="loadFromFile(event)">
    <button onclick="document.getElementById('importFile').click()">파일 불러오기 📁</button>
  </div>
</header>

<section class="card">
  <h2>좋아하는 사진 갤러리 📸</h2>
  <input type="file" id="galleryInput" accept="image/*" multiple>
  <div class="gallery-container" id="galleryContainer"></div>
</section>

<!-- 이하 동일 -->
<section class="card">
  <h2>나의 학교 시간표</h2>
  <table>
    <tr><th>시간/요일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th></tr>
    <tr><td>1교시</td><td>국어</td><td>수학</td><td>과학</td><td>체육</td><td>영어</td></tr>
    <tr><td>2교시</td><td>사회</td><td>음악</td><td>미술</td><td>국어</td><td>과학</td></tr>
  </table>
</section>

<footer style="text-align:center; color:#6b7280; margin-top:40px;">© 2025 나의 소개 페이지</footer>

<!-- 편집 모달 -->
<div id="editModal">
  <div class="modal-content">
    <h3>자기소개 편집</h3>
    <label>프로필 사진 선택:</label>
    <input type="file" id="photoInput" accept="image/*">
    <label>소개글 수정:</label>
    <textarea id="introInput" rows="3"></textarea>
    <label>자기소개 동영상 선택:</label>
    <input type="file" id="videoInput" accept="video/*">
    <div style="text-align:right; margin-top:10px;">
      <button onclick="saveChanges()">저장</button>
      <button onclick="closeEditModal()">닫기</button>
    </div>
  </div>
</div>

<!-- 이미지 보기 모달 -->
<div id="imageModal">
  <span class="arrow left" onclick="prevImage()">&#10094;</span>
  <img id="modalImage" src="">
  <span class="arrow right" onclick="nextImage()">&#10095;</span>
</div>

<script>
  let galleryImages = [];
  let currentIndex = 0;

  // 상태 관리
  function setStatus(text){ document.getElementById("status").textContent = "상태: " + text; }

  function openEditModal(){ document.getElementById("editModal").style.display = "flex"; }
  function closeEditModal(){ document.getElementById("editModal").style.display = "none"; }

  function saveChanges(){
    const introText = document.getElementById("introInput").value;
    if(introText) document.getElementById("intro-text").textContent = introText;

    const photo = document.getElementById("photoInput").files[0];
    if(photo){
      const r = new FileReader();
      r.onload = e => document.getElementById("profile-img").src = e.target.result;
      r.readAsDataURL(photo);
    }
    closeEditModal();
  }

  const galleryInput = document.getElementById("galleryInput");
  const galleryContainer = document.getElementById("galleryContainer");
  galleryInput.addEventListener("change", e=>{
    Array.from(e.target.files).forEach(file=>{
      const r = new FileReader();
      r.onload = ev=>{
        galleryImages.push(ev.target.result);
        const img = document.createElement("img");
        img.src = ev.target.result;
        img.className="thumbnail";
        img.onclick=()=>openImageModal(galleryImages.indexOf(ev.target.result));
        galleryContainer.appendChild(img);
      };
      r.readAsDataURL(file);
    });
  });

  function openImageModal(i){ currentIndex=i; document.getElementById("modalImage").src=galleryImages[i];
    document.getElementById("imageModal").style.display="flex"; }
  function closeImageModal(){ document.getElementById("imageModal").style.display="none"; }
  function nextImage(){ if(galleryImages.length){ currentIndex=(currentIndex+1)%galleryImages.length;
    document.getElementById("modalImage").src=galleryImages[currentIndex]; } }
  function prevImage(){ if(galleryImages.length){ currentIndex=(currentIndex-1+galleryImages.length)%galleryImages.length;
    document.getElementById("modalImage").src=galleryImages[currentIndex]; } }

  document.getElementById("imageModal").addEventListener("click", e=>{
    if(e.target.id==="imageModal") closeImageModal();
  });

  // -------------------------------
  // ✅ 저장 및 불러오기 (파일 내보내기/불러오기 + 로컬저장)
  // -------------------------------
  function collectData(){
    return {
      intro: document.getElementById("intro-text").textContent,
      status: document.getElementById("status").textContent,
      profile: document.getElementById("profile-img").src,
      gallery: galleryImages
    };
  }

  function saveToLocal(){
    localStorage.setItem("myProfileData", JSON.stringify(collectData()));
    alert("로컬에 저장되었습니다!");
  }

  function downloadData(){
    const blob = new Blob([JSON.stringify(collectData(), null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "my_profile.json";
    a.click();
  }

  function loadFromFile(event){
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = e=>{
      const data = JSON.parse(e.target.result);
      applyData(data);
      localStorage.setItem("myProfileData", JSON.stringify(data)); // 동기화
      alert("불러오기 완료!");
    };
    reader.readAsText(file);
  }

  function applyData(data){
    if(data.intro) document.getElementById("intro-text").textContent = data.intro;
    if(data.status) document.getElementById("status").textContent = data.status;
    if(data.profile) document.getElementById("profile-img").src = data.profile;
    if(data.gallery){
      galleryImages = data.gallery;
      galleryContainer.innerHTML="";
      data.gallery.forEach(src=>{
        const img=document.createElement("img");
        img.src=src; img.className="thumbnail";
        img.onclick=()=>openImageModal(galleryImages.indexOf(src));
        galleryContainer.appendChild(img);
      });
    }
  }

  // 페이지 로드시 자동 복원
  window.addEventListener("load", ()=>{
    const saved = localStorage.getItem("myProfileData");
    if(saved) applyData(JSON.parse(saved));
  });
</script>

</body>
</html>
